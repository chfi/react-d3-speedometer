"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _from=require("babel-runtime/core-js/array/from"),_from2=_interopRequireDefault(_from),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_d=require("d3");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var ReactSpeedometer=function(a){function b(a){(0,_classCallCheck3.default)(this,b);var c=(0,_possibleConstructorReturn3.default)(this,(b.__proto__||(0,_getPrototypeOf2.default)(b)).call(this,a));return c.render=function(){return _react2.default.createElement("div",{ref:function ref(a){return c.gaugeDiv=a}})},c._d3_refs={powerGauge:!1},c.initialValue=0,c}return(0,_inherits3.default)(b,a),(0,_createClass3.default)(b,[{key:"componentWillMount",value:function componentWillMount(){}},{key:"componentDidMount",value:function componentDidMount(){this.renderGauge()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(){this.initialValue=this.props.value||0}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(a){return!0}},{key:"componentWillUpdate",value:function componentWillUpdate(){}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.props.forceRender?this.renderGauge():this.updateReadings()}},{key:"getGauge",value:function getGauge(){var a=this,b=this.props;return function(c){function e(a){return a*i/180}function d(){var a=k.width/2;l=k.maxAngle-k.minAngle,m=Math.round(a*k.pointerHeadLengthPercent),p=(0,_d.scaleLinear)().range([0,1]).domain([k.minValue,k.maxValue]),q=p.ticks(k.majorTicks),s=(0,_d.range)(k.majorTicks).map(function(){return 1/k.majorTicks}),o=(0,_d.arc)().innerRadius(a-k.ringWidth-k.ringInset).outerRadius(a-k.ringInset).startAngle(function(a,b){return e(k.minAngle+a*b*l)}).endAngle(function(a,b){return e(k.minAngle+a*(b+1)*l)})}function f(a){var b=k.labelFormat(a);return k.currentValueText.replace("${value}",b);var c=function(a,b){return new Function(b,"return `"+a+"`;")}(k.currentValueText,"value")}var g=Math.sin,h=Math.cos,i=Math.PI,j={ringInset:20,pointerWidth:5,pointerTailLength:5,pointerHeadLengthPercent:0.9,minAngle:-90,maxAngle:90,labelInset:10,parentWidth:a.gaugeDiv.parentNode.clientWidth,parentHeight:a.gaugeDiv.parentNode.clientHeight},k={width:b.fluidWidth?j.parentWidth:b.width,height:b.fluidWidth?j.parentHeight:b.height,pointerHeadLengthPercent:b.pointerHeadLengthPercent||j.pointerHeadLengthPercent,ringWidth:b.ringWidth,ringInset:b.ringInset||j.ringInset,labelInset:b.labelInset||j.labelInset,minAngle:b.minAngle||j.minAngle,maxAngle:b.maxAngle||j.maxAngle,minValue:b.minValue,maxValue:b.maxValue,needleColor:b.needleColor,majorTicks:b.segments,arcColorFn:(0,_d.interpolateHsl)((0,_d.rgb)(b.startColor),(0,_d.rgb)(b.endColor)),needleTransition:b.needleTransition,needleTransitionDuration:b.needleTransitionDuration,textColor:b.textColor,labelFormat:(0,_d.format)(b.valueFormat),currentValueText:b.currentValueText};k=(0,_assign2.default)({},j,k);var l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,s=void 0,r=function(a){return function(b){var c=b.minA,d=b.maxA,e=(0,_from2.default)(Array(a+1),function(b,e){return e*((d-c)/a)+c});return e}},t=function(a){var b=a+i/2;return{x:-h(b),y:-g(b)}};return d(),{configure:d,isRendered:function(){return void 0!=n},render:function(){var f=k.width/2;n=(0,_d.select)(c).append("svg:svg").attr("class","speedometer").attr("width",k.width).attr("height",k.height);var d="translate("+f+","+f+")";Array.isArray(b.tickSegments)&&b.tickSegments.forEach(function addTicks(a,b){return function(c,e){return function(f){var g=f.numTicks,h=f.tickLength,i=a.append("g").attr("transform",d),j=r(g)({minA:c,maxA:e});return j.map(t).forEach(function(a){var c=a.x,d=a.y,e=b,f=e-h;i.append("path").attr("d","M "+c*e+","+d*e+" L "+c*f+","+d*f+" z").attr("stroke","#888888")})}}}(n,f-k.ringInset-1)(e(k.minAngle),e(k.maxAngle)));var i=n.append("g").attr("class","arc").attr("transform",d);i.selectAll("path").data(s).enter().append("path").attr("class","speedo-segment").attr("fill",function(a,b){return k.arcColorFn(a*b)}).attr("d",o);var j=n.append("g").attr("class","label").attr("transform",d);j.selectAll("text").data(q).enter().append("text").attr("transform",function(a){var b=k.labelInset-f,c=p(a),d=e(k.minAngle+c*l+90),i=h(d)*b,j=g(d)*b;return"translate("+i+","+j+")"}).text(k.labelFormat).attr("class","segment-value").style("text-anchor","middle").style("font-size","14px").style("font-weight","bold").style("fill",k.textColor);var u=[[k.pointerWidth/2,0],[0,-m],[-(k.pointerWidth/2),0],[0,k.pointerTailLength],[k.pointerWidth/2,0]],v=(0,_d.line)().curve(_d.curveMonotoneX),w=n.append("g").data([u]).attr("class","pointer").attr("transform",d).style("fill",k.needleColor),x=n.append("g").attr("transform",d).append("circle").attr("r",30).attr("class","valueCircle").style("stroke",k.textColor);a._d3_refs.current_value_text=n.append("g").attr("transform",d).append("text").attr("class","current-value").attr("text-anchor","middle").attr("dominant-baseline","central").text(k.currentValue||"").style("font-size","24px").style("font-family","sans-serif").style("fill",k.textColor),a._d3_refs.pointer=w.append("path").attr("d",v).attr("transform","rotate("+k.minAngle+")")},update:function(b){var c=p(b),d=k.minAngle+c*l;a._d3_refs.pointer.transition().duration(k.needleTransitionDuration).ease(a.getTransitionMethod(k.needleTransition)).attr("transform","rotate("+d+")"),a._d3_refs.current_value_text.text(f(b))},config:k}}}},{key:"renderGauge",value:function renderGauge(){(0,_d.select)(this.gaugeDiv).select("svg").remove(),this._d3_refs.powerGauge=this.getGauge()(this.gaugeDiv),this._d3_refs.powerGauge.render(this.initialValue),this.updateReadings()}},{key:"updateReadings",value:function updateReadings(){this._d3_refs.powerGauge.config.labelFormat=(0,_d.format)(this.props.valueFormat||""),this._d3_refs.powerGauge.config.currentValueText=this.props.currentValueText||"${value}",this._d3_refs.powerGauge.update(this.props.value||0)}},{key:"getTransitionMethod",value:function getTransitionMethod(a){switch(a){case"easeLinear":return _d.easeLinear;break;case"easeQuadIn":return _d.easeQuadIn;break;case"easeQuadOut":return _d.easeQuadOut;break;case"easeQuadInOut":return _d.easeQuadInOut;break;case"easeCubicIn":return _d.easeCubicIn;break;case"easeCubicOut":return _d.easeCubicOut;break;case"easeCubicInOut":return _d.easeCubicInOut;break;case"easePolyIn":return _d.easePolyIn;break;case"easePolyOut":return _d.easePolyOut;break;case"easePolyInOut":return _d.easePolyInOut;break;case"easeSinIn":return _d.easeSinIn;break;case"easeSinOut":return _d.easeSinOut;break;case"easeSinInOut":return _d.easeSinInOut;break;case"easeExpIn":return _d.easeExpIn;break;case"easeExpOut":return _d.easeExpOut;break;case"easeExpInOut":return _d.easeExpInOut;break;case"easeCircleIn":return _d.easeCircleIn;break;case"easeCircleOut":return _d.easeCircleOut;break;case"easeCircleInOut":return _d.easeCircleInOut;break;case"easeBounceIn":return _d.easeBounceIn;break;case"easeBounceOut":return _d.easeBounceOut;break;case"easeBounceInOut":return _d.easeBounceInOut;break;case"easeBackIn":return _d.easeBackIn;break;case"easeBackOut":return _d.easeBackOut;break;case"easeBackInOut":return _d.easeBackInOut;break;case"easeElasticIn":return _d.easeElasticIn;break;case"easeElasticOut":return _d.easeElasticOut;break;case"easeElasticInOut":return _d.easeElasticInOut;break;case"easeElastic":return _d.easeElastic;break;case"easeElastic":return _d.easeElastic;break;default:return _d.easeQuadInOut;}}}]),b}(_react2.default.Component);ReactSpeedometer.displayName="ReactSpeedometer";ReactSpeedometer.propTypes={value:_propTypes2.default.number.isRequired,minValue:_propTypes2.default.number.isRequired,maxValue:_propTypes2.default.number.isRequired,minAngle:_propTypes2.default.number,maxAngle:_propTypes2.default.number,ringInset:_propTypes2.default.number,labelInset:_propTypes2.default.number,forceRender:_propTypes2.default.bool.isRequired,width:_propTypes2.default.number.isRequired,height:_propTypes2.default.number.isRequired,fluidWidth:_propTypes2.default.bool.isRequired,segments:_propTypes2.default.number.isRequired,tickSegments:_propTypes2.default.arrayOf(_propTypes2.default.shape({numTicks:_propTypes2.default.number,tickLength:_propTypes2.default.number})),needleColor:_propTypes2.default.string.isRequired,startColor:_propTypes2.default.string.isRequired,endColor:_propTypes2.default.string.isRequired,needleTransition:_propTypes2.default.string.isRequired,needleTransitionDuration:_propTypes2.default.number.isRequired,ringWidth:_propTypes2.default.number.isRequired,textColor:_propTypes2.default.string.isRequired,valueFormat:_propTypes2.default.string.isRequired,currentValueText:_propTypes2.default.string.isRequired},ReactSpeedometer.defaultProps={value:0,minValue:0,maxValue:1e3,minAngle:-90,maxAngle:90,forceRender:!1,width:300,height:300,fluidWidth:!1,segments:5,needleColor:"steelblue",startColor:"#FF471A",endColor:"#33CC33",needleTransition:"easeQuadInOut",needleTransitionDuration:500,ringWidth:60,textColor:"#666",valueFormat:"",currentValueText:"${value}"},exports.default=ReactSpeedometer;